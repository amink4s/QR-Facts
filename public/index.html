<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Facts</title>
    <meta name="fc:miniapp" content='{"version":"1","imageUrl":"https://qr-facts.vercel.app/image.png","button":{"title":"qr facts","action":{"type":"launch_miniapp","name":"qr facts","splashImageUrl":"https://qr-facts.vercel.app/splash.png","splashBackgroundColor":"#FFFFFF"}}}' />
    <meta name="fc:frame" content='{"version":"1","imageUrl":"https://qr-facts.vercel.app/image.png","button":{"title":"qr facts","action":{"type":"launch_frame","name":"qr facts","splashImageUrl":"https://qr-facts.vercel.app/splash.png","splashBackgroundColor":"#FFFFFF"}}}' />
    <script type="module" src="https://miniapps.farcaster.xyz/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/viem@2.x/dist/viem.min.js"></script>
    <script src="https://auth.farcaster.xyz/bundle/auth-kit.js"></script>
    <script src="./app.js"></script>
    <style>
        body { background: #0f0f0f; color: white; font-family: 'Inter', sans-serif; }
        .neon { color: #a855f7; }
        .qr-border { border: 2px solid #a855f7; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="min-h-screen p-4" x-data="app" x-init="init()">
    <!-- Header (unchanged) -->
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold neon mb-2">QR Facts</h1>
        <p class="text-gray-400 mb-4">Daily Bidder Deep Dives â€¢ Powered by $FACTS</p>

        <template x-if="!user.username">
            <p class="text-gray-400">Login to view & claim</p>
            <button @click="login()" class="bg-neon text-black px-6 py-3 rounded-full font-bold">Login with Farcaster</button>
        </template>

        <template x-if="user.username">
            <div class="flex items-center justify-center gap-4 mb-4">
                <img :src="user.pfp" alt="PFP" class="w-12 h-12 rounded-full border-2 border-neon">
                <div class="text-left">
                    <p class="font-bold">@<span x-text="user.username"></span></p>
                    <p class="text-sm text-gray-400">Neynar Score: <span x-text="user.score?.toFixed(2) || 'N/A'"></span></p>
                </div>
            </div>
        </template>

        <div class="qr-border inline-block p-4 rounded-lg bg-black pulse mb-4">
            <svg width="120" height="120" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <rect width="100" height="100" fill="#a855f7" opacity="0.1"/>
                <rect x="10" y="10" width="20" height="20" fill="#a855f7"/>
                <rect x="70" y="10" width="20" height="20" fill="#a855f7"/>
                <rect x="10" y="70" width="20" height="20" fill="#a855f7"/>
                <rect x="70" y="70" width="20" height="20" fill="#a855f7"/>
            </svg>
        </div>
    </div>

    <!-- Bids List -->
    <div class="max-w-md mx-auto space-y-4" x-show="user.username">
        <p x-show="loading" class="text-center text-gray-400">Loading today's bidders from chain...</p>

        <template x-for="bid in bids" :key="bid.url">
            <div class="bg-gray-900 p-5 rounded-lg border border-gray-700">
                <h3 class="font-bold neon text-lg">
                    <span x-text="bid.contributors.length > 1 ? 'Group Bid (' + bid.contributors.length + ')' : bid.contributors[0]?.slice(0,6) + '...' + bid.contributors[0]?.slice(-4)"></span>
                </h3>
                <p class="text-sm text-gray-400 mt-1">
                    Total Bid: $<span x-text="(bid.amount / 1000000).toFixed(2)"></span> USDC
                </p>
                <p class="text-sm text-gray-400 break-all">
                    Redirect URL: <a :href="bid.url" target="_blank" class="neon underline" x-text="bid.url"></a>
                </p>

                <template x-if="bid.fact">
                    <div class="mt-4 p-3 bg-gray-800 rounded">
                        <h4 class="font-semibold mb-2" x-text="bid.fact.title || 'Fact Sheet'"></h4>
                        <p class="text-sm" x-text="bid.fact.article"></p>
                        <p class="text-xs text-gray-500 mt-2" x-if="bid.fact.ca_or_link">CA/Link: <span x-text="bid.fact.ca_or_link"></span></p>
                    </div>
                </template>

                <template x-if="!bid.fact && isMyBid(bid)">
                    <button @click="openModal(bid)" class="mt-4 bg-neon text-black px-5 py-2 rounded font-bold">
                        Add My Facts (+200 $FACTS)
                    </button>
                </template>

                <button @click="claimFacts()" class="mt-4 w-full py-2 rounded font-bold"
                        :class="claimClass" :disabled="claimDisabled">
                    <span x-text="claimText"></span>
                </button>
            </div>
        </template>

        <p x-show="!loading && bids.length === 0" class="text-center text-gray-400">No active bids today</p>
    </div>

    <!-- Submission Modal (unchanged) -->
    <div class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50" x-show="modalOpen" @click="modalOpen = false">
        <div class="bg-gray-900 p-6 rounded-lg max-w-lg w-full mx-4" @click.stop>
            <h2 class="text-2xl font-bold neon mb-4">Add Your Facts</h2>
            <input x-model="form.title" placeholder="Title (e.g. Why my token rocks)" class="w-full p-3 bg-gray-800 rounded mb-4 text-white">
            <textarea x-model="form.article" placeholder="Write your project/token description..." rows="8" class="w-full p-3 bg-gray-800 rounded mb-4 text-white"></textarea>
            <input x-model="form.ca" placeholder="Token CA or extra link (optional)" class="w-full p-3 bg-gray-800 rounded mb-4 text-white">
            <div class="flex justify-end gap-3">
                <button @click="modalOpen = false" class="px-5 py-2 text-gray-400">Cancel</button>
                <button @click="submitFact()" class="bg-neon text-black px-6 py-2 rounded font-bold">Submit Facts</button>
            </div>
        </div>
    </div>

    <script src="/app.js"></script>
</body>
</html>